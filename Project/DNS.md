# DNS

## 什么是DNS

域名系统（Domain Name System）是互联网的一种协议，作用于应用层，负责将域名与IP地址做相互映射

## 域名层级

域名是分有层级的，并且每个域名最后还存在一个`.root`作为根域名，只是因为所有域名的根域名都是`.root`，才省略的，但是在DNS查询过程中，会自动补上跟域名

域名结构：

```js
//    主机名.次级域名.顶级域名.根域名
//    即：
//    host.sld.tld.root
//    举例：
//    www.baidu.com.root
//     |    |    |    |
//     |    |    |  根域名
//     |    | 顶级域名
//     | 次级域名
//   主机名
```

## 域名解析

DNS可以通过解析域名查询对应的IP地址，DNS查询分为两种：*递归*和*迭代*。一般客户端使用的DNS服务器内部使用递归的查询方式，而DNS服务器之间使用迭代的查询方式。一般DNS查询域名对应的IP地址采用以下步骤：

- 发送查询报文`host.sld.tld`到DNS服务器，服务器首先查询自身缓存，如果存在记录则返回结果
- 如果记录老化或者不存在，则：
  1. 从”根域名服务器“查到“顶级域名服务器”的NS记录，即顶级域名`.tld`所在服务器地址
  2. 从“顶级域名服务器”查到“次级域名服务器”的NS记录，即次级域名`.sld.tld`所在服务器地址
  3. 从“次级域名服务器”查到“主机”的A记录，即`host.sld.tld`对应的IP地址，存入自身缓存

## 记录类型

DNS系统中，常见记录类型：

- A记录：主机记录（Address），返回域名指向的IP地址
- CNAME记录：别名记录（Canonical Name），用于将某个别名指向A记录，就不需要再为某个新名字创建新的A记录
- AAAA记录：IPv6主机记录，与A记录对应，用于将特定的主机名映射到一个主机的IPv6地址
- NS记录：域名服务器记录（Name Server），用来指定该域名由哪个DNS服务器进行解析。 您注册域名时，总有默认的DNS服务器，每个注册的域名都是由一个DNS域名服务器来进行解析的，DNS服务器NS记录地址一般以以下的形式出现： ns1.domain.com、ns2.domain.com等
- PTR：逆向查询记录（Pointer Record），只用于从IP地址查询域名
